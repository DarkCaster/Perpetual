# Init Operation

The `init` operation is the starting point for using Perpetual with your project. It sets up the necessary configuration and directory structure required for Perpetual to function properly within your project environment.

## Usage

To initialize a new Perpetual configuration for your project, run the following command **from the root directory of your project**:

```sh
Perpetual init [flags]
```

The `init` operation supports several command-line flags to customize its behavior:

- `-l <language>`: **Select the programming language** for setting up default LLM prompts. This flag is required and must be provided with a valid language option.
- `-h`: **Display the help message**, showing all available flags and their descriptions.
- `-v`: **Enable debug logging**. This flag increases the verbosity of the operation's output.
- `-vv`: **Enable both debug and trace logging**. This flag provides the highest level of verbosity.
- `-c`: **Clean obsolete files and directories**. When used, this flag removes deprecated configuration files and directories from the `.perpetual` directory.

### Example Usage

```sh
Perpetual init -l go
```

This command initializes Perpetual for a Go project, setting up the appropriate configuration and prompt files.

## Supported Languages

Perpetual currently supports the following programming languages and technologies:

1. **Go (`go`)**  
2. **.NET Framework (`dotnetfw`)** – Includes C#, VB.NET, WPF  
3. **Bash (`bash`)** – Intended mostly for Linux use  
4. **Python 3 (`python3`)**  
5. **Visual Basic 6 (`vb6`)** – Legacy VB6, may be removed in future releases  
6. **C (`c`)**  
7. **C++ (`cpp`)**  
8. **Arduino (`arduino`)** – Arduino Sketches with C++ support  
9. **Flutter (`flutter`)** – Flutter/Dart apps with a focus on Flutter

When using the `-l` flag, provide the language identifier as shown above. You can add support for your programming language or project manually by editing file-selection regexps and LLM prompts in corresponding config files (see below).

## Details

The `init` operation performs several tasks to set up your project for use with Perpetual:

1. **Creates a `.perpetual` directory** in your project root.  
2. **Creates a global configuration directory** if it doesn't exist.  
3. **Generates default configuration files and prompts** for the selected programming language.  
4. **Creates a `.gitignore` file** within the `.perpetual` directory to exclude specific Perpetual files from version control.  
5. **Creates example `.env.example` files** for Perpetual and each supported LLM provider (e.g., `.env.example`, `ollama.env.example`, `openai.env.example`, `anthropic.env.example`, `generic.env.example`).  
6. **Creates a `description.md.template` file** that can be used as a starting point for creating a project description document.  
7. **Cleans obsolete configuration files and directories** if the `-c` flag is used.  

When run inside an already initialized project, it will overwrite current config files and create any missing ones.

**Note:** The `init` operation respects the `PERPETUAL_DIR` environment variable. If set, it uses the specified directory instead of creating `.perpetual` in the current directory.

### Directory and File Structure

After running the `init` operation, the following structure is created:

```text
<project_root>/
└── .perpetual/
    ├── .gitignore
    ├── .env.example
    ├── ollama.env.example
    ├── openai.env.example
    ├── anthropic.env.example
    ├── generic.env.example
    ├── description.md.template
    ├── op_annotate.json
    ├── op_implement.json
    ├── op_doc.json
    ├── op_explain.json
    ├── op_report.json
    └── project.json
```

### Customizable Files

Most files generated by the `init` operation can be customized to fine-tune Perpetual's behavior for your project:

1. **`.env` files**  
   Perpetual does not create a `.env` file by default. To configure environment variables, copy one or more of the provider-specific example files (e.g., `openai.env.example`) as `*.env` files and the general `.env.example` as `.env` and modify these files as needed. You can merge files into a single `.env` file or keep them as multiple `*.env` files. Perpetual loads `*.env` files in alphabetical order from the following directories, with options from files that are loaded first taking precedence over options from files loaded later:
   - System environment variables  
   - Project-local env files: `<project_root>/.perpetual/*.env`  
   - Global env files: e.g., `~/.config/Perpetual/*.env` on Linux or `<User profile dir>\AppData\Roaming\Perpetual\*.env` on Windows  
2. **Operation-specific JSON configs**  
   Files like `op_annotate.json`, `op_implement.json`, `op_doc.json`, `op_explain.json`, and `op_report.json` contain prompts, regex patterns, and other settings Perpetual uses when interacting with your source code. You can adjust these to change how Perpetual processes files.  
3. **`project.json`**  
   - **`files_to_md_code_mappings`**: Maps file extensions or patterns to Markdown code-block languages.  
   - **`project_files_blacklist`**: Regex patterns to exclude certain files from processing.  
   - **`project_files_whitelist`**: Regex patterns to include relevant files.  
   - **`project_test_files_blacklist`**: Patterns to exclude test files.

These configuration files can be committed to version control to share and track changes across your team.

### Files Not Intended for User Modification

The following are managed automatically by Perpetual and should not be edited manually:

1. **`.annotations.json`**: Stores source-code annotations for your project. Updated via the `annotate` operation.  
2. **`.embeddings.msgpack`**: Stores source-code vector embeddings for your project. Updated via the `embed` operation.  
3. **`.stash/`**: Contains code backups created during operations. Managed by the `stash` operation.  
4. **`.message_log.txt*`**: Logs interactions with the LLM provider for debugging purposes (includes rotated log files).  

## Cleaning Obsolete Files and Directories

When running `init` with the `-c` flag, Perpetual will remove deprecated items from the `.perpetual` directory:

- **Obsolete Files**  
  - `filename_embed_regexp.json`  
  - `filename_tags_regexps.json`  
  - `filename_tags.json`  
  - `no_upload_comment_regexps.json`  
  - `output_tags_regexps.json`  
  - `project_files_blacklist.json`  
  - `project_files_to_markdown_lang_mappings.json`  
  - `project_files_whitelist.json`  
  - `reasonings_tags_regexps.json`  
  - `reasonings_tags.json`  

- **Obsolete Directories**  
  - `prompts`
